<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Word of the Day Bot</title>
</head>
<body>
  <h1>Word of the Day Bot</h1>
  <p>Current Block Height: <span id="current-block"></span></p>
  <p>Blocks until next word: <span id="blocks-until-next"></span></p>
  <h2>Ongoing Words</h2>
  <div id="ongoing-words"></div>
  <h2>Leaderboard</h2>
  <div id="leaderboard"></div>

  <script>
    async function loadData() {
      const state = await fetch('/words.json').then(res => res.json());
      const current_block = await fetch('https://blockstream.info/api/blocks/tip/height').then(res => res.text()).then(text => parseInt(text));
      document.getElementById('current-block').textContent = current_block;
      const blocks_until_next = state.next_word_block - current_block;
      document.getElementById('blocks-until-next').textContent = blocks_until_next > 0 ? blocks_until_next : 'soon';

      const ongoingWordsDiv = document.getElementById('ongoing-words');
      state.words.forEach(word => {
        const div = document.createElement('div');
        div.innerHTML = `
          <h3>Posted at block ${word.posted_at_block}</h3>
          <img src="${word.image_url}" alt="image" width="256">
          <p>Hints posted: ${word.hints_posted}</p>
          ${word.winner ? `<p>Word: ${word.word}</p><p>Winner: nostr:${word.winner}</p>` : '<p>Not guessed yet</p>'}
        `;
        ongoingWordsDiv.appendChild(div);
      });

      const leaderboardDiv = document.getElementById('leaderboard');
      const leaderboard = Object.entries(state.leaderboard).sort((a, b) => b[1] - a[1]);
      leaderboard.forEach(([npub, wins]) => {
        const p = document.createElement('p');
        p.textContent = `nostr:${npub}: ${wins} wins`;
        leaderboardDiv.appendChild(p);
      });
    }

    loadData().catch(console.error);
  </script>
</body>
</html>
